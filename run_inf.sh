length=$((2**20))
#trainer.restart="$(pwd)/outputs/2024-12-11/19-51-43-946988/test_model/3" \
#restartfolder='outputs/2024-12-14/05-15-39-705557/ft_model/99'
#restartfolder='outputs/2024-12-15/04-04-37-034448/ft_model/99'
#restartfolder='outputs/2024-12-16/02-55-07-720206/ft_model/99'
#restartfolder='outputs/2024-12-17/03-05-32-353487/ft_model/99'
#restartfolder='outputs/2024-12-17/06-03-31-348056/ft_model/638'
CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7 accelerate launch --num_processes 8 finetune_esp_accel_gpu.py   \
	+trainer.restart=false \
	+single_gene=false \
	+trainer.save_preds=true \
	trainer.max_epochs=1000 \
	dataset.shuffle=false \
	dataset=replogle \
	experiment=hg38/replogle  \
	+dataset.path="$(pwd)/dataset_gears_norman_sgrna_ctrl_bulk_8gpu_sp42" \
       	callbacks.model_checkpoint_every_n_steps.every_n_train_steps=500 \
	dataset.max_length=$length   \
	dataset.batch_size=1  \
	dataset.mlm=true   \
	dataset.mlm_probability=0.15   \
	dataset.rc_aug=false   \
	+dataset.lower_lim=0 \
	+dataset.upper_lim=4 \
	model=caduceus   \
	+model.config.freeze_n_layers=0 \
	model.config.d_model=64 \
	model.config.ssm_cfg.headdim=16   \
	model.config.n_layer=8   \
	model.config.bidirectional=true   \
	dataset.context_parallel=false \
	model.config.ssm_cfg.context_parallel=false  \
	model.config.bidirectional_strategy=add   \
	model.config.bidirectional_weight_tie=true   \
	model.config.rcps=false   \
	optimizer.lr="1.e-4"   \
	train.global_batch_size=1   \
	trainer.max_steps=10000   \
	+trainer.val_check_interval=10000   \
	wandb=null
